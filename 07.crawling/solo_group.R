# --------------------------------------------------------------------
# 멜론 차트에 랭크된 솔로 가수와 그룹 가수 구분하기
# '(여자)아이들 ' 그룹은 도저히 방법이 없어서 예외 처리함
# 그룹 조건 : ()안 글자는 제거 후, 가수이름은 한글 3글자 이하
# --------------------------------------------------------------------

# 필요한 패키지 로드
library(dplyr)

# 엑셀 파일에서 멜론 차트 데이터 불러오기 (가정)
melon <- read_excel("data/melon_rank_20240904.xlsx", sheet = "Sheet1")

# 괄호 안의 글자 제거
melon$가수_정제 <- gsub("\\s*\\([^\\)]+\\)", "", melon$가수)

# 한글만 남기기 위해 정규표현식을 사용한 필터링
melon$한글_가수명 <- gsub("[^가-힣]", "", melon$가수_정제)

# 가수명 구분 (한글 이름이 3글자 이하이면 솔로로 구분, '아이들'이 포함되면 그룹)
melon$구분 <- ifelse(grepl("아이들", melon$가수_정제), "그룹",
                   ifelse(nchar(melon$한글_가수명) <= 3 & nchar(melon$한글_가수명) > 0, "솔로", "그룹"))

# 결과 확인
View(melon)
stat <- table(melon$구분)

View(stat)

# --------------------------------------------------------------------
# 솔로 곡과 그룹 곡의 평균 순위 계산
# --------------------------------------------------------------------

avg_rank_by_type <- melon %>%
  group_by(구분) %>%  # "구분"은 솔로 또는 그룹을 나타냄
  summarize(평균순위 = mean(순위, na.rm = TRUE))  # 평균 순위를 계산

# 결과 확인
View(avg_rank_by_type)


# --------------------------------------------------------------------
# 솔로 곡과 그룹 곡의 순위 분포 히스토그램 시각화
# --------------------------------------------------------------------

library(ggplot2)

# 솔로 곡과 그룹 곡의 순위 분포 히스토그램
ggplot(melon, aes(x = 순위, fill = 구분)) +
  geom_histogram(binwidth = 5, position = "dodge", color = "black") +
  labs(title = "솔로 곡 vs 그룹 곡 순위 분포", x = "순위", y = "빈도") +
  theme_minimal()


# --------------------------------------------------------------------
# 솔로 곡과 그룹 곡의 순위 변동 분석 (상위 10곡 추출)
# --------------------------------------------------------------------


# 상위 10곡 추출
top_10_songs <- melon %>%
  arrange(순위) %>%
  slice(1:10)

# 상위 10곡의 솔로/그룹 비율 확인
stat <- table(top_10_songs$구분)

View(stat)



